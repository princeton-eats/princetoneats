<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Results - Princeton Eats</title>
    <!-- CSS files -->

    <link rel="stylesheet" href=
         "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

         <link rel="stylesheet" href="static/css/base.css">
         <link rel="stylesheet" href="static/css/meals_list.css">

</head>

<body class="d-flex flex-column min-vh-100">

    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #FFE6D0; color: #2A100C; padding-left: 20px; padding-right: 20px;">
        <a class="navbar-brand" href="/" style="font-size: x-large;"><strong>PrincetonEats!</strong></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav ms-auto">
                <a class="nav-item nav-link" href="/">Home</a>
                <a class="nav-item nav-link" href="/find_meals">Find Meals</a>
                <a class="nav-item nav-link" href="/about">About</a>
                <a class="nav-item nav-link" href="{% if username %}/logoutcas{% else %}/logincas{% endif %}">Sign {% if username %}out{% else %}in{% endif %}</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid flex-fill d-flex justify-content-center align-items-center">
        <div class="row w-75 justify-content-center">

            <div class="containerMeals col-md-9 text-center" >
                {% if grouped_meals|length == 0 %}
                    <div class="empty-results">
                        <p>No meals found that match your criteria. Try adjusting your preferences or dining hall selection.</p>
                    </div>
                {% else %}
                    <h2>Here are Your Options</h2>
                    <div class="unroll-instruction">Click on a dining hall mat to unroll and see the meals</div>
                    <hr class="line">

                    <!-- Scroll indicators -->
                    <div class="scroll-indicator scroll-left" id="scrollLeft">&#8249;</div>
                    <div class="scroll-indicator scroll-right" id="scrollRight">&#8250;</div>

                    <!-- Container for the single row of rolled mats -->
                    <div class="dhall-container" id="dhallContainer">
                        {% for dhall, meals in grouped_meals.items() %}
                            <!-- Each dining hall is a rolled mat that expands when clicked -->
                            <div class="dhall-box" onclick="toggleMat(this)">
                                <div class="mat-ribbon"></div>
                                <h3 class="dhall-title">{{ dhall }}</h3>
                                <div class="content">
                                    <ul>
                                        {% for meal in meals %}
                                            <li class="meal-item">
                                                <strong>{{ meal["name"] }}</strong>
                                                <div>
                                                    <span class="dropdown">
                                                        Ingredients
                                                        <div class="dropdown-content">
                                                            <ul>
                                                            {% for ingredient in meal["ingredients"] %}
                                                                <li>{{ ingredient }}</li>
                                                            {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </span>

                                                    <span class="dropdown">
                                                        Allergens
                                                        <div class="dropdown-content">
                                                            <ul>
                                                            {% for allergen in meal["allergens"] %}
                                                                <li>{{ allergen }}</li>
                                                            {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </span>
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="containerSmall col-md-3 text-center ms-md-4">
                <h2>REMEMBER!</h2>
                <div id="warning">
                    <p style="text-align: center;">Always follow up with campus dining staff to confirm ingredients!</p>
                </div>
            </div>

        </div>
    </div>

    <div class="container-fluid back-buttons justify-content-center">
        <center>
        <button onclick="location.href='/find_meals'" class="custom-button">Back</button>
        <button onclick="location.href='/'" class="custom-button">Home</button>
        </center>
    </div>

    <div class="container-fluid, footer" style="padding: 5px;">
        <center>
            &copy; COS 333 Final Project
            <br>
            Made by Achilles, Adham, Akuei, Ndongo, and Yusuf
        </center>
    </div>

    <script>
        // Add interactive functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth scroll functionality
            const container = document.getElementById('dhallContainer');
            const scrollLeftBtn = document.getElementById('scrollLeft');
            const scrollRightBtn = document.getElementById('scrollRight');

            if (scrollLeftBtn && scrollRightBtn && container) {
                // Scroll buttons
                scrollLeftBtn.addEventListener('click', function(e) {
                    container.scrollBy({ left: -300, behavior: 'smooth' });
                    e.stopPropagation();
                });

                scrollRightBtn.addEventListener('click', function(e) {
                    container.scrollBy({ left: 300, behavior: 'smooth' });
                    e.stopPropagation();
                });
            }

            // Prevent dropdown clicks from toggling the mat
            const dropdowns = document.querySelectorAll('.dropdown');
            dropdowns.forEach(dropdown => {
                dropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            });
        });

        // Toggle mat expansion
        function toggleMat(element) {
            // Check if the click was on a dropdown
            if (event.target.closest('.dropdown-content') || event.target.closest('.dropdown')) {
                return;
            }

            // Toggle the expanded class
            element.classList.toggle('expanded');

            // Scroll the mat into view if it's expanded
            if (element.classList.contains('expanded')) {
                element.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }
    </script>
</body>
</html>
